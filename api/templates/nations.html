{% extends "base.html" %}
{% block title %}Nations | ViewPol{% endblock %}

{% block content %}
<a href="/">Back to home</a>
<h1>Nations</h1>

<div class="search-bar">
    <form method="get" action="/nations">
        <input type="text" name="q" placeholder="Search nations..." value="{{ query }}">
        <input type="hidden" name="page" value="1">
        <button type="submit">Search</button>
    </form>
</div>

<div class="grid nationgrid">
    {% for n in players %}
    <div class="player-card" style="padding: 20px; box-sizing: border-box;">
        <img loading="lazy"
             src="https://cdn.earthpol.com/nations/{{ n.name }}.png"
             alt="{{ n.name }} flag"
             style="width: 100%; height: auto; max-height: 180px; object-fit: contain;"
             onerror="this.style.display='none'">

        <a href="/nations/{{ n.uuid }}" style="display: block; text-align: center;">{{ n.name }}</a>
    </div>
    {% endfor %}
</div>

<div class="pagination">
    {% if page > 1 %}
        <a href="/nations?page=1&q={{ query }}">« First</a>
        <a href="/nations?page={{ page-1 }}&q={{ query }}">‹ Prev</a>
    {% endif %}

    {% set start = page - 2 if page > 2 else 1 %}
    {% set end = page + 2 if page < total_pages - 2 else total_pages %}

    {% if start > 1 %}
        <span>…</span>
    {% endif %}

    {% for i in range(start, end + 1) %}
        {% if i == page %}
            <a class="current">{{ i }}</a>
        {% else %}
            <a href="/nations?page={{ i }}&q={{ query }}">{{ i }}</a>
        {% endif %}
    {% endfor %}

    {% if end < total_pages %}
        <span>…</span>
    {% endif %}

    {% if page < total_pages %}
        <a href="/nations?page={{ page+1 }}&q={{ query }}">Next ›</a>
        <a href="/nations?page={{ total_pages }}&q={{ query }}">Last »</a>
    {% endif %}
</div>

{% endblock %}
