{% extends "base.html" %}
{% block title %}Players | ViewPol{% endblock %}

{% block content %}
<a href="/">Back to home</a>
<h1>Players</h1>

<div class="search-bar">
    <form method="get" action="/players">
        <input type="text" name="q" placeholder="Search players..." value="{{ query }}">
        <input type="hidden" name="page" value="1">
        <button type="submit">Search</button>
    </form>
</div>

<div class="grid">
    {% for p in players %}
    <div class="player-card">
        <img loading="lazy"
             src="https://api.mineatar.io/head/{{ p.uuid }}?scale=15&overlay=true&format=png"
             alt="{{ p.name }}'s head">

        <a href="/players/{{ p.uuid }}">{{ p.name }}</a>
    </div>
    {% endfor %}
</div>

<div class="pagination">
    {% if page > 1 %}
        <a href="/players?page=1&q={{ query }}">« First</a>
        <a href="/players?page={{ page-1 }}&q={{ query }}">‹ Prev</a>
    {% endif %}

    {% set start = page - 2 if page > 2 else 1 %}
    {% set end = page + 2 if page < total_pages - 2 else total_pages %}

    {% if start > 1 %}
        <span>…</span>
    {% endif %}

    {% for i in range(start, end + 1) %}
        {% if i == page %}
            <a class="current">{{ i }}</a>
        {% else %}
            <a href="/players?page={{ i }}&q={{ query }}">{{ i }}</a>
        {% endif %}
    {% endfor %}

    {% if end < total_pages %}
        <span>…</span>
    {% endif %}

    {% if page < total_pages %}
        <a href="/players?page={{ page+1 }}&q={{ query }}">Next ›</a>
        <a href="/players?page={{ total_pages }}&q={{ query }}">Last »</a>
    {% endif %}
</div>

{% endblock %}
